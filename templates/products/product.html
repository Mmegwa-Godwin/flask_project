<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-left">
            <a href="{{ url_for('shop.index') }}" class="brand">Shop</a>
        </div>
        <div class="nav-right">
            {% if current_user.is_authenticated %}
                <span class="greeting">Hi, {{ current_user.username }}</span>
                {% set cart = current_user.cart %}
                <a href="{{ url_for('shop.view_cart') }}">
                    Cart
                    {% if cart %}
                        {% set total_qty = 0 %}
                        {% set total_price = 0 %}
                        {% for item in cart.items %}
                            {% set total_qty = total_qty + item.quantity %}
                            {% set total_price = total_price + item.quantity * item.product.price %}
                        {% endfor %}
                        ({{ total_qty }} items - ₦{{ '{:,.2f}'.format(total_price) }})
                    {% endif %}
                </a>
                <a href="{{ url_for('users.logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('users.login') }}">Login</a>
                <a href="{{ url_for('users.signup') }}">Sign Up</a>
            {% endif %}
        </div>
    </nav>

    <!-- Product Details -->
    <div class="product-detail">
        <h1>{{ product.name }}</h1>
        <p>Price: ₦{{ '{:,.2f}'.format(product.price) }}</p>
        <p>{{ product.description }}</p>

        <!-- Add to Cart Form -->
        {% if current_user.is_authenticated %}
        <form action="{{ url_for('shop.add_to_cart', product_id=product.id) }}" method="POST">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">Add to Cart</button>
        </form>
        {% else %}
            <p><a href="{{ url_for('users.login') }}">Login</a> to add this product to your cart.</p>
        {% endif %}
    </div>
</body>
</html>
