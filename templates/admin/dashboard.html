{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Admin Dashboard</h2>

    <!-- Products Table -->
    <div class="mb-5">
        <h4>Products</h4>
        <a href="{{ url_for('admin.add_product') }}" class="btn btn-success mb-3">Add New Product</a>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>{{ product.id }}</td>
                    <td>{{ product.name }}</td>
                    <td>₦{{ "{:,.2f}".format(product.price) }}</td>
                   <td>
    <a href="{{ url_for('admin.edit_product', product_id=product.id) }}" class="btn btn-sm btn-primary">Edit</a>
    <form action="{{ url_for('admin.delete_product', product_id=product.id) }}" method="POST" style="display:inline-block;">
        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this product?');">
            Delete
        </button>
    </form>
</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Orders Table -->
    <div>
        <h4>Orders</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.user.username }}</td>
                    <td>₦{{ "{:,.2f}".format(order.total_price) }}</td>
                    <td>{{ order.status }}</td>
                    <td>
    {% if order.status != 'Processed' %}
        <a href="{{ url_for('admin.process_order', order_id=order.id) }}" 
           class="btn btn-sm btn-primary">
           Process
        </a>
    {% else %}
        <span class="text-success">Processed</span>
    {% endif %}
     <!-- Preview Button -->
        <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" 
                data-bs-target="#orderModal{{ order.id }}">
            Preview
        </button>
</td>
                </tr>
                {% for order in orders %}
<div class="modal fade" id="orderModal{{ order.id }}" tabindex="-1" aria-labelledby="orderModalLabel{{ order.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderModalLabel{{ order.id }}">Order #{{ order.id }} Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Product</th>
              <th>Quantity</th>
              <th>Price (₦)</th>
              <th>Subtotal (₦)</th>
            </tr>
          </thead>
          <tbody>
           <tr>
    <td>{{ order.id }}</td>
    <td>{{ order.user.username }}</td>
    <td>₦{{ "{:,.2f}".format(order.total_price) }}</td>

    <!-- Status with conditional styling -->
    <td class="{% if order.status == 'Processed' %}status-processed{% else %}status-pending{% endif %}">
        {{ order.status }}
    </td>

    <td>
        {% if order.status != 'Processed' %}
            <a href="{{ url_for('admin.process_order', order_id=order.id) }}" class="btn btn-sm btn-primary">Process</a>
        {% else %}
            <span class="text-success">Processed</span>
        {% endif %}
        <!-- Preview Button -->
        <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#orderModal{{ order.id }}">
            Preview
        </button>
    </td>
</tr>


